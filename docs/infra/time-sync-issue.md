---
id: time-sync-issue
title: crontab을 활용한 시간 동기화 문제 해결
description: GitHub Actions의 self-hosted runner에서 발생한 시간 동기화 문제를 해결한 경험
sidebar_position: 3
tags:
  - github-actions
  - self-hosted-runner
  - crontab
  - nptdate
date: 2025-07-18
---
> 2025-07-18, crontab을 활용한 시간 동기화 문제 해결 경험입니다.

### 개요
Github Actions의 자체 호스팅 Runner를 통해 서비스의 배포 자동화를 구현한 이후,  
`Runner` 머신의 시간 동기화 문제로 인해 머신이 정상적으로 작동하지 않는 상황이 발생했다.  
이 문제를 해결하면서 서버와 시간을 동기화하고 이를 자동화한 경험을 정리해보려 한다.

## 문제 상황과 수습
***
`Runner`의 머신 로그를 확인해보니, 아래와 같은 오류가 발생하고 있었다.

```
The local machine's clock may be out of sync with the server time by more than five minutes.
Please sync your clock with your domain or internet time and try again.
```

시스템 시간이 GitHub 서버와 5분 이상 차이가 나면 `Runner`가 작동하지 않는다는 오류 메시지였다.  
이 문제를 해결하기 위해 `ntpdate`명령어를 활용해 구글의 힘을 빌려 시간을 동기화를 진행했다.

```shell
sudo ntpdate time.google.com
```

서버와 시간을 맞추고 나서 `Runner`를 재시작하니 정상적으로 작동했다.

## 서버의 시간은 왜 Github 서버와 차이가 날까?
***
**서버의 시간은 생각보다 정확하지 않다.**  
실제로는 표준 시간에 비해 하루에 몇 초씩 밀리거나 빨라질 수 있는데, 이는 서버 내 하드웨어 시계가 완벽하지 않기 때문이다.  
부하나 온도 변화, 네트워크 환경 등 다양한 요인으로 하루에 수초의 오차가 발생할 수 있다.  
반면, GitHub의 서버는 UTC 기준으로 정밀하게 시간 동기화되어 있기 때문에, 이런 시간 차이가 발생하게 된다.

### 서버 시간 동기화의 중요성
서버의 시간이 계속 오차가 나면 다음과 같은 문제가 발생할 수 있다:
- 로그 시간이 정확하지 않아 문제 해결이 어려워진다.
- 인증서 유효 기간이나 토큰 만료 시간이 맞지않아 생길 수 있는 문제들이 발생한다.

클라우드 서버를 활용하는 서비스의 경우는 클라우드 서버가 시간 동기화를 자동으로 관리해주지만,  
자체 호스팅 서버의 경우는 개발자가 수동으로 시간을 동기화해줘야 한다.

### 구글의 서버시간을 사용해도 괜찮을까?
서버 시간을 동기화 하기위해 구글의 `time.google.com`을 사용했다.  
구글은 UTC 기준의 신뢰할 수 있는 시간 서버이기 때문에, 표준 시간 동기화에 적합하다.

## 지속적인 해결 방안
***
앞서 간단하게 서버의 시간을 동기화 해주었지만, 주기적으로 시간 동기화를 하지 않으면 같은 문제가 계속 발생하게 된다.  
이를 해결하기 위해  `crontab`을 활용하여 시간 동기화를 하루에 한 번 자동으로 수행하도록 설정했다.
> `crontab`이란 리눅스에서 주기적으로 명령어를 실행할 수 있도록 예약하는 기능이다.

### crontab 설정
```
# crontab -e
# 매일 0시 0분에 시간 동기화
0 0 * * * /usr/sbin/ntpdate time.google.com >> /tmp/rdate.log 2>&1
```
이렇게 설정하면 매일 0시 0분에 `ntpdate` 명령어를 실행하여 서버 시간을 구글의 시간 서버와 동기화한다.  
동기화 결과는 `/tmp/rdate.log` 파일에 기록되며, 오류 메시지도 함께 기록된다.  

`crontab`을 작성한 후 `crontab -l` 명령어를 통해 설정이 잘 되었는지 확인할 수 있다.  
이후 주기적으로 서버에 접속하여 `/tmp/rdate.log` 파일을 확인해보면, 서버가 정상적으로 시간 동기화를 진행하고 있는지 확인할 수 있다.

## 마무리
***
해결은 간단했지만, 시스템 시간이 정확하지 않으면 Runner 전체가 동작하지 않을 수 있다는 점에서
작은 문제가 전체 프로세스에 미치는 영향을 체감할 수 있었다.
앞으로는 이런 기초 시스템 설정도 꼼꼼하게 점검하는 습관을 가져야겠다고 느꼈다.
